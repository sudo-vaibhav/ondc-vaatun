{
  "openapi": "3.1.0",
  "info": {
    "title": "ONDC Integration API",
    "version": "1.0.0",
    "description": "\n# ONDC Integration API\n\nThis API provides integration endpoints for the Open Network for Digital Commerce (ONDC) platform.\n\n## What is ONDC?\n\nONDC (Open Network for Digital Commerce) is a Government of India initiative to democratize e-commerce by creating an open, interoperable network. It allows buyers and sellers to transact across different platforms without being locked into a single marketplace.\n\n## API Organization\n\nThis API is organized into three groups:\n\n- **Registry**: Endpoints that communicate with the ONDC Registry for subscriber management\n- **Gateway**: Endpoints that communicate with the ONDC Gateway for transaction flows\n- **Internal**: Utility endpoints for health checks and result polling\n\n## Authentication\n\nThis API uses two different authentication patterns:\n\n### Outbound Requests (Your App → ONDC)\nRoutes: `/api/ondc/lookup`, `/api/ondc/subscribe`, `/api/ondc/search`, `/api/ondc/select`\n\nUses **Ed25519 HTTP Signatures** with BLAKE-512 digest. See the \"Ed25519Signature\" security scheme for detailed implementation guide.\n\n### Inbound Callbacks (ONDC → Your App)\nRoutes: `/api/ondc/on_subscribe`, `/api/ondc/on_search`, `/api/ondc/on_select`\n\nONDC/BPPs sign their requests to you. Your app should verify their signatures using their public keys from the registry.\n\n## External Documentation\n\n- [ONDC Official Website](https://ondc.org/)\n- [Beckn Protocol Documentation](https://developers.becknprotocol.io/)\n- [ONDC FIS Specifications (Insurance)](https://github.com/ONDC-Official/ONDC-FIS-Specifications)\n    ",
    "contact": {
      "name": "Vaatun Technologies",
      "email": "vaibhav@vaatun.com"
    },
    "license": {
      "name": "MIT"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Local development"
    },
    {
      "url": "https://ondc-staging.vaatun.com",
      "description": "Staging environment"
    }
  ],
  "components": {
    "schemas": {
      "HealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "example": "Health OK!!"
          },
          "ready": {
            "type": "boolean",
            "example": true
          }
        },
        "required": ["status", "ready"]
      },
      "Subscriber": {
        "type": "object",
        "properties": {
          "subscriber_id": {
            "type": "string",
            "example": "ondc-staging.vaatun.com"
          },
          "subscriber_url": {
            "type": "string"
          },
          "type": {
            "type": "string",
            "example": "bap"
          },
          "domain": {
            "type": "string",
            "example": "ONDC:FIS13"
          },
          "city": {
            "type": "string",
            "example": "std:080"
          },
          "country": {
            "type": "string",
            "example": "IND"
          },
          "signing_public_key": {
            "type": "string",
            "example": "MCowBQYDK2VwAyEA..."
          },
          "encr_public_key": {
            "type": "string",
            "example": "MCowBQYDK2VuAyEA..."
          },
          "valid_from": {
            "type": "string",
            "example": "2024-01-01T00:00:00.000Z"
          },
          "valid_until": {
            "type": "string",
            "example": "2025-12-31T23:59:59.999Z"
          },
          "status": {
            "type": "string"
          },
          "created": {
            "type": "string"
          },
          "updated": {
            "type": "string"
          }
        },
        "required": [
          "subscriber_id",
          "type",
          "domain",
          "signing_public_key",
          "encr_public_key",
          "valid_from",
          "valid_until"
        ],
        "additionalProperties": {}
      },
      "LookupResponse": {
        "type": "array",
        "items": {
          "$ref": "#/components/schemas/Subscriber"
        }
      },
      "SubscribeResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "object",
            "properties": {
              "ack": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "example": "ACK"
                  }
                },
                "required": ["status"]
              }
            },
            "required": ["ack"]
          }
        },
        "required": ["message"],
        "additionalProperties": {}
      },
      "OnSubscribeResponse": {
        "type": "object",
        "properties": {
          "answer": {
            "type": "string",
            "example": "decrypted_challenge_answer",
            "description": "Decrypted challenge answer"
          }
        },
        "required": ["answer"]
      },
      "OnSubscribeRequest": {
        "type": "object",
        "properties": {
          "subscriber_id": {
            "type": "string",
            "example": "ondc-staging.vaatun.com"
          },
          "challenge": {
            "type": "string",
            "example": "base64_encrypted_challenge_string",
            "description": "Base64 encoded encrypted challenge from ONDC"
          }
        },
        "required": ["challenge"],
        "additionalProperties": {}
      },
      "SearchResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "object",
            "properties": {
              "ack": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "example": "ACK"
                  }
                },
                "required": ["status"]
              }
            },
            "required": ["ack"]
          },
          "transactionId": {
            "type": "string",
            "format": "uuid",
            "example": "019abc12-..."
          },
          "messageId": {
            "type": "string",
            "format": "uuid",
            "example": "019abc12-..."
          }
        },
        "required": ["transactionId", "messageId"],
        "additionalProperties": {}
      },
      "SelectResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "object",
            "properties": {
              "ack": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "example": "ACK"
                  }
                },
                "required": ["status"]
              }
            },
            "required": ["ack"]
          },
          "transactionId": {
            "type": "string",
            "format": "uuid",
            "example": "019abc12-3456-7890-abcd-ef1234567890"
          },
          "messageId": {
            "type": "string",
            "format": "uuid",
            "example": "019abc12-3456-7890-abcd-ef1234567891"
          }
        },
        "required": ["transactionId", "messageId"],
        "additionalProperties": {}
      },
      "SelectAddOn": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "example": "addon-001"
          },
          "quantity": {
            "type": "integer",
            "exclusiveMinimum": 0,
            "example": 1
          }
        },
        "required": ["id", "quantity"]
      },
      "SelectRequest": {
        "type": "object",
        "properties": {
          "transactionId": {
            "type": "string",
            "format": "uuid",
            "example": "019abc12-3456-7890-abcd-ef1234567890"
          },
          "bppId": {
            "type": "string",
            "example": "ondc-mock-server.example.com"
          },
          "bppUri": {
            "type": "string",
            "format": "uri",
            "example": "https://ondc-mock-server.example.com/api/ondc"
          },
          "providerId": {
            "type": "string",
            "example": "provider-001"
          },
          "itemId": {
            "type": "string",
            "example": "item-001"
          },
          "parentItemId": {
            "type": "string",
            "example": "item-001"
          },
          "xinputFormId": {
            "type": "string",
            "example": "form-001"
          },
          "xinputSubmissionId": {
            "type": "string",
            "example": "submission-001"
          },
          "addOns": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SelectAddOn"
            },
            "example": [
              {
                "id": "addon-001",
                "quantity": 1
              }
            ]
          }
        },
        "required": [
          "transactionId",
          "bppId",
          "bppUri",
          "providerId",
          "itemId",
          "parentItemId"
        ]
      },
      "AckResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "object",
            "properties": {
              "ack": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": ["ACK", "NACK"],
                    "example": "ACK"
                  }
                },
                "required": ["status"]
              }
            },
            "required": ["ack"]
          },
          "error": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string"
              },
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            }
          }
        },
        "required": ["message"]
      },
      "BecknContext": {
        "type": "object",
        "properties": {
          "domain": {
            "type": "string",
            "example": "ONDC:FIS13"
          },
          "action": {
            "type": "string",
            "example": "on_search"
          },
          "bap_id": {
            "type": "string",
            "example": "ondc-staging.vaatun.com"
          },
          "bap_uri": {
            "type": "string",
            "example": "https://ondc-staging.vaatun.com/api/ondc"
          },
          "bpp_id": {
            "type": "string",
            "example": "ondc-mock-server.example.com"
          },
          "bpp_uri": {
            "type": "string",
            "example": "https://ondc-mock-server.example.com"
          },
          "transaction_id": {
            "type": "string",
            "example": "019abc12-3456-7890-abcd-ef1234567890"
          },
          "message_id": {
            "type": "string",
            "example": "019abc12-3456-7890-abcd-ef1234567891"
          },
          "timestamp": {
            "type": "string",
            "example": "2024-01-01T00:00:00.000Z"
          },
          "version": {
            "type": "string",
            "example": "2.0.1"
          }
        },
        "additionalProperties": {}
      },
      "OnSearchRequest": {
        "type": "object",
        "properties": {
          "context": {
            "$ref": "#/components/schemas/BecknContext"
          },
          "message": {
            "type": "object",
            "properties": {
              "catalog": {
                "description": "BPP catalog with providers and items"
              }
            },
            "additionalProperties": {}
          },
          "error": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string"
              },
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            },
            "additionalProperties": {}
          }
        },
        "additionalProperties": {}
      },
      "OnSelectAckResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "object",
            "properties": {
              "ack": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": ["ACK", "NACK"],
                    "example": "ACK"
                  }
                },
                "required": ["status"]
              }
            },
            "required": ["ack"]
          },
          "error": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string"
              },
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            }
          }
        },
        "required": ["message"]
      },
      "OnSelectRequest": {
        "type": "object",
        "properties": {
          "context": {
            "type": "object",
            "properties": {
              "domain": {
                "type": "string",
                "example": "ONDC:FIS13"
              },
              "action": {
                "type": "string",
                "example": "on_select"
              },
              "bap_id": {
                "type": "string",
                "example": "ondc-staging.vaatun.com"
              },
              "bap_uri": {
                "type": "string",
                "example": "https://ondc-staging.vaatun.com/api/ondc"
              },
              "bpp_id": {
                "type": "string",
                "example": "ondc-mock-server.example.com"
              },
              "bpp_uri": {
                "type": "string",
                "example": "https://ondc-mock-server.example.com"
              },
              "transaction_id": {
                "type": "string",
                "example": "019abc12-3456-7890-abcd-ef1234567890"
              },
              "message_id": {
                "type": "string",
                "example": "019abc12-3456-7890-abcd-ef1234567891"
              },
              "timestamp": {
                "type": "string",
                "example": "2024-01-01T00:00:00.000Z"
              },
              "version": {
                "type": "string",
                "example": "2.0.1"
              }
            },
            "additionalProperties": {}
          },
          "message": {
            "type": "object",
            "properties": {
              "order": {
                "type": "object",
                "properties": {
                  "provider": {},
                  "items": {
                    "type": "array",
                    "items": {}
                  },
                  "quote": {
                    "type": "object",
                    "properties": {
                      "price": {
                        "type": "object",
                        "properties": {
                          "currency": {
                            "type": "string",
                            "example": "INR"
                          },
                          "value": {
                            "type": "string",
                            "example": "1000.00"
                          }
                        },
                        "additionalProperties": {}
                      },
                      "breakup": {
                        "type": "array",
                        "items": {}
                      }
                    },
                    "additionalProperties": {}
                  }
                },
                "additionalProperties": {}
              }
            },
            "additionalProperties": {}
          },
          "error": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string"
              },
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            },
            "additionalProperties": {}
          }
        },
        "additionalProperties": {}
      },
      "ProviderSummary": {
        "type": "object",
        "properties": {
          "bppId": {
            "type": "string",
            "example": "ondc-mock-server.example.com"
          },
          "bppUri": {
            "type": "string",
            "example": "https://ondc-mock-server.example.com"
          },
          "name": {
            "type": "string",
            "example": "ICICI Prudential"
          },
          "itemCount": {
            "type": "integer",
            "example": 5
          },
          "hasError": {
            "type": "boolean",
            "example": false
          }
        },
        "required": ["bppId", "itemCount", "hasError"]
      },
      "SearchResultsResponse": {
        "type": "object",
        "properties": {
          "found": {
            "type": "boolean",
            "example": true
          },
          "transactionId": {
            "type": "string",
            "example": "019abc12-3456-7890-abcd-ef1234567890"
          },
          "messageId": {
            "type": "string",
            "example": "019abc12-3456-7890-abcd-ef1234567891"
          },
          "searchTimestamp": {
            "type": "string",
            "example": "2024-01-01T00:00:00.000Z"
          },
          "categoryCode": {
            "type": "string",
            "example": "HEALTH_INSURANCE"
          },
          "responseCount": {
            "type": "integer",
            "example": 3
          },
          "providers": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProviderSummary"
            },
            "example": [
              {
                "bppId": "ondc-mock-server.example.com",
                "bppUri": "https://ondc-mock-server.example.com",
                "name": "ICICI Prudential",
                "itemCount": 5,
                "hasError": false
              }
            ]
          },
          "responses": {
            "type": "array",
            "items": {},
            "description": "Raw on_search responses from BPPs"
          },
          "message": {
            "type": "string",
            "example": "No search entry found for this transaction ID"
          }
        },
        "required": [
          "found",
          "transactionId",
          "responseCount",
          "providers",
          "responses"
        ],
        "additionalProperties": {}
      },
      "Quote": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "example": "quote-001"
          },
          "price": {
            "type": "object",
            "properties": {
              "currency": {
                "type": "string",
                "example": "INR"
              },
              "value": {
                "type": "string",
                "example": "15000.00"
              }
            },
            "required": ["currency", "value"],
            "additionalProperties": {}
          },
          "breakup": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string",
                  "example": "Base Premium"
                },
                "price": {
                  "type": "object",
                  "properties": {
                    "currency": {
                      "type": "string",
                      "example": "INR"
                    },
                    "value": {
                      "type": "string",
                      "example": "15000.00"
                    }
                  },
                  "required": ["currency", "value"],
                  "additionalProperties": {}
                },
                "item": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "add_ons": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          }
                        },
                        "required": ["id"]
                      }
                    }
                  },
                  "additionalProperties": {}
                }
              },
              "required": ["title", "price"],
              "additionalProperties": {}
            }
          },
          "ttl": {
            "type": "string",
            "example": "PT30M"
          }
        },
        "required": ["price"],
        "additionalProperties": {}
      },
      "SelectProvider": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "example": "provider-001"
          },
          "descriptor": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "example": "ICICI Prudential"
              },
              "short_desc": {
                "type": "string"
              },
              "long_desc": {
                "type": "string"
              },
              "images": {
                "type": "array",
                "items": {}
              }
            },
            "additionalProperties": {}
          }
        },
        "required": ["id"],
        "additionalProperties": {}
      },
      "SelectItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "example": "item-001"
          },
          "parent_item_id": {
            "type": "string"
          },
          "descriptor": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "example": "Health Guard Plus"
              },
              "short_desc": {
                "type": "string"
              },
              "long_desc": {
                "type": "string"
              },
              "images": {
                "type": "array",
                "items": {}
              }
            },
            "additionalProperties": {}
          },
          "price": {
            "type": "object",
            "properties": {
              "currency": {
                "type": "string",
                "example": "INR"
              },
              "value": {
                "type": "string",
                "example": "15000.00"
              }
            },
            "required": ["currency", "value"],
            "additionalProperties": {}
          },
          "xinput": {},
          "add_ons": {
            "type": "array",
            "items": {}
          },
          "tags": {
            "type": "array",
            "items": {}
          }
        },
        "required": ["id"],
        "additionalProperties": {}
      },
      "SelectResultsResponse": {
        "type": "object",
        "properties": {
          "found": {
            "type": "boolean",
            "example": true
          },
          "transactionId": {
            "type": "string",
            "example": "019abc12-3456-7890-abcd-ef1234567890"
          },
          "messageId": {
            "type": "string",
            "example": "019abc12-3456-7890-abcd-ef1234567891"
          },
          "itemId": {
            "type": "string",
            "example": "item-001"
          },
          "providerId": {
            "type": "string",
            "example": "provider-001"
          },
          "hasResponse": {
            "type": "boolean",
            "example": true
          },
          "quote": {
            "$ref": "#/components/schemas/Quote"
          },
          "provider": {
            "$ref": "#/components/schemas/SelectProvider"
          },
          "item": {
            "$ref": "#/components/schemas/SelectItem"
          },
          "xinput": {
            "description": "XInput form details for additional data collection"
          },
          "error": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            },
            "additionalProperties": {}
          },
          "message": {
            "type": "string",
            "example": "No select entry found for this transaction"
          }
        },
        "required": ["found", "transactionId", "messageId", "hasResponse"],
        "additionalProperties": {}
      }
    },
    "parameters": {},
    "securitySchemes": {
      "Ed25519Signature": {
        "type": "apiKey",
        "in": "header",
        "name": "Authorization",
        "description": "\n# ONDC Ed25519 Signature Authentication\n\nAll outbound requests to ONDC Registry and Gateway require Ed25519 digital signatures using HTTP Signature standard.\n\n## Authentication Flow\n\n### Step 1: Calculate BLAKE-512 Digest\n```typescript\nimport { createHash } from \"crypto\";\n\nconst requestBody = JSON.stringify(payload);\nconst digest = createHash(\"blake2b512\")\n  .update(requestBody)\n  .digest(\"base64\");\n```\n\n### Step 2: Create Signing String\n```typescript\nconst created = Math.floor(Date.now() / 1000) - 3; // Clock drift compensation\nconst expires = created + 300; // 5 minute validity\n\nconst signingString =\n  `(created): ${created}\\n` +\n  `(expires): ${expires}\\n` +\n  `digest: BLAKE-512=${digest}`;\n```\n\n### Step 3: Sign with Ed25519\n```typescript\nimport sodium from \"libsodium-wrappers\";\n\nawait sodium.ready;\n\nconst privateKey = sodium.from_base64(process.env.SIGNING_PRIVATE_KEY);\nconst signature = sodium.crypto_sign_detached(signingString, privateKey);\nconst signatureBase64 = sodium.to_base64(signature);\n```\n\n### Step 4: Construct Authorization Header\n```typescript\nconst keyId = `${subscriberId}|${uniqueKeyId}|ed25519`;\n\nconst authHeader =\n  `Signature keyId=\"${keyId}\",` +\n  `algorithm=\"ed25519\",` +\n  `created=\"${created}\",` +\n  `expires=\"${expires}\",` +\n  `headers=\"(created) (expires) digest\",` +\n  `signature=\"${signatureBase64}\"`;\n```\n\n## Clock Drift Compensation\n\nThe implementation subtracts 3 seconds from the current timestamp to account for clock drift between your server and ONDC servers:\n\n```typescript\nconst created = Math.floor(Date.now() / 1000) - 3; // Subtract 3 seconds\n```\n\nThis prevents authentication failures due to slight time differences.\n\n## Key Management\n\n### Environment Variables Required\n\n- `SIGNING_PRIVATE_KEY`: Ed25519 private key (base64-encoded, 64 bytes)\n- `UNIQUE_KEY_ID`: Unique identifier for this key pair (e.g., \"custom-key-id\")\n- `SUBSCRIBER_ID`: Your registered ONDC subscriber ID (e.g., \"ondc-staging.vaatun.com\")\n\n## Implementation Reference\n\nSee full implementation in:\n- `/src/lib/ondc/client.ts` - ONDCClient.createAuthorizationHeader()\n- `/src/lib/ondc/signing.ts` - Ed25519 signing utilities\n- `/src/entities/tenant.ts` - Key management\n\n## Inbound vs Outbound Authentication\n\n### Outbound (Your App → ONDC)\n- **Routes**: `/api/ondc/lookup`, `/api/ondc/subscribe`, `/api/ondc/search`, `/api/ondc/select`\n- **You sign**: Using your `SIGNING_PRIVATE_KEY`\n- **ONDC verifies**: Using your public key from registry\n\n### Inbound (ONDC → Your App)\n- **Routes**: `/api/ondc/on_subscribe`, `/api/ondc/on_search`, `/api/ondc/on_select`\n- **ONDC signs**: Using their private key\n- **You verify**: Using their public key from registry (retrieved via `/lookup`)\n    "
      }
    }
  },
  "paths": {
    "/api/ondc/health": {
      "get": {
        "summary": "Health Check",
        "description": "Service health monitoring endpoint. Returns service status and readiness. Verifies that tenant configuration is loaded and ONDC client is initialized.",
        "tags": ["Internal"],
        "operationId": "healthCheck",
        "directoryConfig": {
          "title": "Health Check",
          "description": "Check if the service is running"
        },
        "responses": {
          "200": {
            "description": "Service is healthy and ready",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          },
          "503": {
            "description": "Service is not ready",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/ondc/lookup": {
      "get": {
        "summary": "Lookup Tenant Subscription",
        "description": "Look up the current tenant's subscription in the ONDC registry.\n\nThis endpoint queries the ONDC Registry using the configured tenant's subscriber ID and domain code to retrieve registration details.\n\n**Use Cases:**\n- Verify tenant registration status\n- Retrieve public keys for the tenant\n- Check subscription validity",
        "tags": ["Registry"],
        "operationId": "lookup",
        "externalDocs": {
          "description": "Beckn Registry API - Lookup Specification",
          "url": "https://developers.becknprotocol.io/docs/registry-api-reference/registry/lookup"
        },
        "directoryConfig": {
          "title": "Registry Lookup",
          "description": "Look up tenant subscription in the ONDC registry"
        },
        "responses": {
          "200": {
            "description": "Successful lookup",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LookupResponse"
                }
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/api/ondc/subscribe": {
      "post": {
        "summary": "Trigger Subscription",
        "description": "Trigger a subscription request to the ONDC registry.\n\nThis endpoint sends the tenant's registration details to the ONDC registry to initiate or refresh network subscription.\n\n**Flow:**\n1. Builds subscription payload with tenant details (GST, PAN, keys)\n2. Signs and sends request to ONDC registry\n3. Registry responds with ACK and triggers on_subscribe callback",
        "tags": ["Registry"],
        "operationId": "subscribe",
        "directoryConfig": {
          "title": "Trigger Subscription",
          "description": "Send subscription request to ONDC registry"
        },
        "responses": {
          "200": {
            "description": "Subscription request accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SubscribeResponse"
                }
              }
            }
          },
          "500": {
            "description": "Server error"
          }
        }
      }
    },
    "/api/ondc/on_subscribe": {
      "post": {
        "summary": "Handle Subscription Challenge",
        "description": "Callback endpoint for ONDC subscription challenge-response verification.\n\nThis endpoint is called by the ONDC registry during the subscription process to verify that the subscriber controls the claimed domain.\n\n**Flow:**\n1. Registry sends encrypted challenge\n2. Service decrypts using shared secret (Diffie-Hellman derived)\n3. Returns plaintext answer to prove key possession",
        "tags": ["Registry"],
        "operationId": "onSubscribe",
        "requestBody": {
          "required": true,
          "description": "Subscription challenge from ONDC registry",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OnSubscribeRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Challenge decrypted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OnSubscribeResponse"
                }
              }
            }
          },
          "400": {
            "description": "Challenge is required"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/api/ondc/search": {
      "post": {
        "summary": "Search Insurance",
        "description": "Initiate a search for insurance products on the ONDC network.\n\nThis endpoint broadcasts a search request to the ONDC gateway, which routes it to all registered insurance providers.\n\n**Flow:**\n1. Generates transaction and message IDs\n2. Creates search payload for health insurance\n3. Sends signed request to ONDC gateway\n4. Returns transaction ID to poll for results",
        "tags": ["Gateway"],
        "operationId": "search",
        "directoryConfig": {
          "title": "Search Insurance",
          "description": "Search for insurance products on ONDC network"
        },
        "responses": {
          "200": {
            "description": "Search request accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResponse"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable"
          }
        }
      }
    },
    "/api/ondc/select": {
      "post": {
        "summary": "Select Insurance Item",
        "description": "Select a specific insurance item to get a quote.\n\nThis endpoint sends a select request to the BPP (seller) to get pricing details for a specific item.\n\n**Flow:**\n1. Receives item selection with provider and item IDs\n2. Optionally includes XInput form submission for eligibility\n3. Sends signed request directly to BPP\n4. Returns transaction ID to poll for quote via on_select callback",
        "tags": ["Gateway"],
        "operationId": "select",
        "directoryConfig": {
          "title": "Select Item",
          "description": "Select an insurance item to get a quote",
          "payload": {
            "transactionId": "019abc12-3456-7890-abcd-ef1234567890",
            "bppId": "ondc-mock-server.example.com",
            "bppUri": "https://ondc-mock-server.example.com/api/ondc",
            "providerId": "provider-001",
            "itemId": "item-001",
            "parentItemId": "item-001"
          }
        },
        "requestBody": {
          "required": true,
          "description": "Item selection details",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SelectRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Select request accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SelectResponse"
                }
              }
            }
          },
          "400": {
            "description": "Missing required fields"
          },
          "503": {
            "description": "Service unavailable"
          }
        }
      }
    },
    "/api/ondc/on_search": {
      "post": {
        "summary": "Receive Search Results",
        "description": "Callback endpoint for receiving search results from BPPs.\n\nThis endpoint is called by BPPs (seller platforms) in response to a search request broadcast by the gateway.\n\n**Flow:**\n1. BPP sends catalog with matching providers and items\n2. Service stores the response keyed by transaction_id\n3. Returns ACK to confirm receipt\n4. Results can be polled via /api/ondc/search-results",
        "tags": ["Gateway"],
        "operationId": "onSearch",
        "requestBody": {
          "required": true,
          "description": "Search results from BPP",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OnSearchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results acknowledged",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AckResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/api/ondc/on_select": {
      "post": {
        "summary": "Receive Quote",
        "description": "Callback endpoint for receiving quotes from BPPs.\n\nThis endpoint is called by BPPs (seller platforms) in response to a select request with pricing details.\n\n**Flow:**\n1. BPP sends order quote with price breakup\n2. Service stores the response keyed by transaction_id and message_id\n3. Returns ACK to confirm receipt\n4. Quote can be polled via /api/ondc/select-results",
        "tags": ["Gateway"],
        "operationId": "onSelect",
        "requestBody": {
          "required": true,
          "description": "Quote from BPP",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OnSelectRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Quote acknowledged",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OnSelectAckResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/api/ondc/search-results": {
      "get": {
        "summary": "Poll Search Results",
        "description": "Polling endpoint to fetch aggregated search results for a transaction.\n\nCalled by the frontend to retrieve on_search responses collected from BPPs.\n\n**Flow:**\n1. Client polls with transaction_id from initial search\n2. Returns all collected on_search responses\n3. Includes provider summary with item counts\n4. Poll until desired providers respond or timeout",
        "tags": ["Internal"],
        "operationId": "getSearchResults",
        "directoryConfig": {
          "title": "Poll Search Results",
          "description": "Fetch aggregated search results by transaction ID"
        },
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid",
              "example": "019abc12-3456-7890-abcd-ef1234567890",
              "description": "Transaction ID from the initial search request"
            },
            "required": true,
            "description": "Transaction ID from the initial search request",
            "name": "transaction_id",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Search results (may be empty if no responses yet)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResultsResponse"
                }
              }
            }
          },
          "400": {
            "description": "Missing transaction_id query parameter"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/api/ondc/select-results": {
      "get": {
        "summary": "Poll Quote Results",
        "description": "Polling endpoint to fetch quote (select) results for a transaction.\n\nCalled by the frontend to retrieve on_select response with pricing details.\n\n**Flow:**\n1. Client polls with transaction_id and message_id from initial select\n2. Returns quote with price breakup when available\n3. May include XInput form for additional data collection\n4. Poll until response received or timeout",
        "tags": ["Internal"],
        "operationId": "getSelectResults",
        "directoryConfig": {
          "title": "Poll Quote Results",
          "description": "Fetch quote results by transaction and message ID"
        },
        "parameters": [
          {
            "schema": {
              "type": "string",
              "format": "uuid",
              "example": "019abc12-3456-7890-abcd-ef1234567890",
              "description": "Transaction ID from the initial select request"
            },
            "required": true,
            "description": "Transaction ID from the initial select request",
            "name": "transaction_id",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "format": "uuid",
              "example": "019abc12-3456-7890-abcd-ef1234567891",
              "description": "Message ID from the initial select request"
            },
            "required": true,
            "description": "Message ID from the initial select request",
            "name": "message_id",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Select results (may be empty if no response yet)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SelectResultsResponse"
                }
              }
            }
          },
          "400": {
            "description": "Missing transaction_id or message_id query parameters"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    }
  },
  "webhooks": {},
  "tags": [
    {
      "name": "Registry",
      "description": "Endpoints that communicate with the ONDC Registry for subscriber management, lookup, and verification. Includes both outbound requests (lookup, subscribe) and inbound callbacks (on_subscribe).",
      "externalDocs": {
        "description": "Beckn Registry API Reference",
        "url": "https://developers.becknprotocol.io/docs/registry-api-reference/"
      }
    },
    {
      "name": "Gateway",
      "description": "Endpoints that communicate with the ONDC Gateway for transaction flows (search, select, etc.). Includes both outbound requests and inbound callbacks from BPPs (on_search, on_select).",
      "externalDocs": {
        "description": "Beckn Core Specification",
        "url": "https://developers.becknprotocol.io/docs/core-specification/"
      }
    },
    {
      "name": "Internal",
      "description": "Utility endpoints for health checks, result polling, and internal operations. These endpoints are not part of the ONDC protocol."
    }
  ]
}

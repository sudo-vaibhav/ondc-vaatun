---
phase: 03-init-flow
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - client/src/lib/form-schemas/nominee.ts
  - client/src/components/forms/fields/NomineeInput.tsx
  - client/src/components/forms/fields/index.ts
autonomous: true

must_haves:
  truths:
    - "User can enter nominee details (name, DOB, relationship)"
    - "Relationship selection uses dropdown with standard options"
    - "Max 2 nominees enforced by schema"
  artifacts:
    - path: "client/src/lib/form-schemas/nominee.ts"
      provides: "Nominee Zod schema and relationship constants"
      exports: ["nomineeSchema", "nomineesSchema", "NOMINEE_RELATIONSHIPS", "NomineeData"]
    - path: "client/src/components/forms/fields/NomineeInput.tsx"
      provides: "Single nominee entry component with all fields"
      exports: ["NomineeInput"]
  key_links:
    - from: "client/src/components/forms/fields/NomineeInput.tsx"
      to: "client/src/lib/form-schemas/nominee.ts"
      via: "NOMINEE_RELATIONSHIPS import"
      pattern: "import.*NOMINEE_RELATIONSHIPS.*nominee"
    - from: "client/src/components/forms/fields/NomineeInput.tsx"
      to: "client/src/components/ui/select.tsx"
      via: "Select component for relationship"
      pattern: "import.*Select.*ui/select"
---

<objective>
Create nominee form schema and input component for beneficiary details entry.

Purpose: Enable users to add up to 2 nominees to their insurance policy.
Output: Reusable NomineeInput component with Zod validation schema.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-init-flow/03-RESEARCH.md

# Existing patterns to follow
@client/src/lib/form-schemas/personal-info.ts
@client/src/lib/form-schemas/pan-dob.ts
@client/src/components/forms/fields/DateInput.tsx
@client/src/components/ui/select.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create nominee Zod schema</name>
  <files>client/src/lib/form-schemas/nominee.ts</files>
  <action>
Create new file client/src/lib/form-schemas/nominee.ts:

1. Define NOMINEE_RELATIONSHIPS constant array with objects:
   { value: "spouse", label: "Spouse" }
   { value: "son", label: "Son" }
   { value: "daughter", label: "Daughter" }
   { value: "father", label: "Father" }
   { value: "mother", label: "Mother" }
   { value: "other", label: "Other" }

2. Define nomineeSchema with fields:
   - firstName: z.string().min(1, "First name is required")
   - lastName: z.string().min(1, "Last name is required")
   - dateOfBirth: z.string().regex(/^\d{4}-\d{2}-\d{2}$/, "Date must be in YYYY-MM-DD format")
   - relationship: z.enum(["spouse", "son", "daughter", "father", "mother", "other"])

3. Define nomineesSchema:
   z.array(nomineeSchema).max(2, "Maximum 2 nominees allowed")

4. Export type NomineeData = z.infer<typeof nomineeSchema>

Export: nomineeSchema, nomineesSchema, NOMINEE_RELATIONSHIPS, NomineeData
  </action>
  <verify>
    - File exists: `ls client/src/lib/form-schemas/nominee.ts`
    - Exports correct items: `grep -E "export (const|type)" client/src/lib/form-schemas/nominee.ts`
    - TypeScript compiles: `pnpm exec tsc --noEmit -p client`
  </verify>
  <done>
    - nominee.ts schema file created with all validation rules
    - NOMINEE_RELATIONSHIPS constant available for dropdown
    - Max 2 nominees enforced
  </done>
</task>

<task type="auto">
  <name>Task 2: Create NomineeInput component</name>
  <files>
    client/src/components/forms/fields/NomineeInput.tsx
    client/src/components/forms/fields/index.ts
  </files>
  <action>
1. Create NomineeInput.tsx component:

Props interface:
- nominee: NomineeData (the nominee object to edit)
- index: number (0-based index for labeling "Nominee 1", "Nominee 2")
- onUpdate: (nominee: NomineeData) => void
- onRemove: () => void
- errors?: { firstName?: string; lastName?: string; dateOfBirth?: string; relationship?: string }

Component structure:
- Card wrapper with subtle border
- Header row: "Nominee {index + 1}" label + trash icon button for onRemove (only show if index > 0, so first nominee can't be removed)
- Grid layout (2 cols on sm+):
  - First Name: Input with Label, error display
  - Last Name: Input with Label, error display
- Full width row:
  - Date of Birth: Use existing DateInput component
- Full width row:
  - Relationship: Use shadcn Select component
    - SelectTrigger with placeholder "Select relationship"
    - SelectContent with SelectItem for each NOMINEE_RELATIONSHIPS entry
    - onChange updates nominee.relationship

Use Trash2 icon from lucide-react for remove button.

2. Update fields/index.ts barrel export:
   Add export for NomineeInput
  </action>
  <verify>
    - File exists: `ls client/src/components/forms/fields/NomineeInput.tsx`
    - Component exported: `grep "NomineeInput" client/src/components/forms/fields/index.ts`
    - TypeScript compiles: `pnpm exec tsc --noEmit -p client`
  </verify>
  <done>
    - NomineeInput component renders single nominee entry form
    - Relationship dropdown uses shadcn Select
    - DateInput reused for DOB
    - Remove button present for non-first nominees
    - Exported from barrel file
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `pnpm exec tsc --noEmit -p client`
2. Schema exports verified: `grep -E "export" client/src/lib/form-schemas/nominee.ts`
3. Component exported from barrel: `grep "NomineeInput" client/src/components/forms/fields/index.ts`
4. Select component imported: `grep "ui/select" client/src/components/forms/fields/NomineeInput.tsx`
</verification>

<success_criteria>
- nominee.ts schema validates single nominee and array of max 2
- NOMINEE_RELATIONSHIPS provides dropdown options
- NomineeInput component renders complete nominee form
- Component uses existing DateInput for DOB
- Component uses shadcn Select for relationship dropdown
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-init-flow/03-02-SUMMARY.md`
</output>

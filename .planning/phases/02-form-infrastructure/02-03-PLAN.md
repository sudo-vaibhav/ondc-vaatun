---
phase: 02-form-infrastructure
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - client/src/components/forms/fields/PANInput.tsx
  - client/src/components/forms/fields/PhoneInput.tsx
  - client/src/components/forms/fields/DateInput.tsx
  - client/src/components/forms/fields/PEDSelector.tsx
  - client/src/components/forms/fields/index.ts
autonomous: true

must_haves:
  truths:
    - "PANInput formats value to uppercase alphanumeric on blur"
    - "PhoneInput formats value to digits-only on blur"
    - "DateInput uses native date picker and formats on blur"
    - "PEDSelector displays checkbox list of condition categories"
    - "PEDSelector shows 'Other' text field when 'Other' checkbox is checked"
  artifacts:
    - path: "client/src/components/forms/fields/PANInput.tsx"
      provides: "PAN input with blur formatting"
      exports: ["PANInput", "PANInputProps"]
    - path: "client/src/components/forms/fields/PhoneInput.tsx"
      provides: "Phone input with blur formatting"
      exports: ["PhoneInput", "PhoneInputProps"]
    - path: "client/src/components/forms/fields/DateInput.tsx"
      provides: "Date input with blur formatting"
      exports: ["DateInput", "DateInputProps"]
    - path: "client/src/components/forms/fields/PEDSelector.tsx"
      provides: "PED condition selector with checkboxes"
      exports: ["PEDSelector", "PEDSelectorProps"]
    - path: "client/src/components/forms/fields/index.ts"
      provides: "Barrel export for all field components"
      exports: ["PANInput", "PhoneInput", "DateInput", "PEDSelector"]
  key_links:
    - from: "client/src/components/forms/fields/PANInput.tsx"
      to: "client/src/lib/form-formatters.ts"
      via: "import formatPAN"
      pattern: "import.*formatPAN.*from"
    - from: "client/src/components/forms/fields/PEDSelector.tsx"
      to: "client/src/components/ui/collapsible.tsx"
      via: "Collapsible for Other text field"
      pattern: "import.*Collapsible.*from"
---

<objective>
Create specialized form field components for KYC data collection with proper formatting and validation UX.

Purpose: Build reusable field components that handle Indian-specific formats (PAN, phone) and health insurance-specific inputs (PED conditions) with blur-based formatting per user decisions.

Output: Four field components that integrate with React Hook Form and apply formatting on blur.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-form-infrastructure/CONTEXT.md
@.planning/phases/02-form-infrastructure/02-RESEARCH.md
@client/src/components/ui/input.tsx
@client/src/components/ui/label.tsx
@client/src/components/ui/checkbox.tsx
@client/src/components/ui/collapsible.tsx
@client/src/lib/form-formatters.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PANInput, PhoneInput, and DateInput components</name>
  <files>
    client/src/components/forms/fields/PANInput.tsx
    client/src/components/forms/fields/PhoneInput.tsx
    client/src/components/forms/fields/DateInput.tsx
  </files>
  <action>
**Create fields directory and PANInput component:**

File: `client/src/components/forms/fields/PANInput.tsx`

Per CONTEXT.md: "Input formatting (PAN, phone, DOB) applied on blur, not real-time"

```typescript
import { forwardRef, type InputHTMLAttributes } from "react";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { formatPAN } from "@/lib/form-formatters";
import { cn } from "@/lib/utils";

export interface PANInputProps
  extends Omit<InputHTMLAttributes<HTMLInputElement>, "type" | "onChange"> {
  label?: string;
  error?: string;
  value: string;
  onChange: (value: string) => void;
  onBlurFormat?: boolean;  // Default true - format on blur
}

export const PANInput = forwardRef<HTMLInputElement, PANInputProps>(
  ({ label = "PAN Number", error, value, onChange, onBlurFormat = true, className, ...props }, ref) => {
    const handleBlur = (e: React.FocusEvent<HTMLInputElement>) => {
      if (onBlurFormat) {
        const formatted = formatPAN(e.target.value);
        onChange(formatted);
      }
      props.onBlur?.(e);
    };

    return (
      <div className={cn("space-y-2", className)}>
        <Label htmlFor={props.id}>{label}</Label>
        <Input
          ref={ref}
          type="text"
          value={value}
          onChange={(e) => onChange(e.target.value)}
          onBlur={handleBlur}
          placeholder="ABCDE1234F"
          maxLength={10}
          aria-invalid={!!error}
          {...props}
        />
        {error && (
          <p className="text-xs text-destructive">{error}</p>
        )}
      </div>
    );
  }
);
PANInput.displayName = "PANInput";
```

**Create PhoneInput component:**

File: `client/src/components/forms/fields/PhoneInput.tsx`

```typescript
import { forwardRef, type InputHTMLAttributes } from "react";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { formatPhone } from "@/lib/form-formatters";
import { cn } from "@/lib/utils";

export interface PhoneInputProps
  extends Omit<InputHTMLAttributes<HTMLInputElement>, "type" | "onChange"> {
  label?: string;
  error?: string;
  value: string;
  onChange: (value: string) => void;
  onBlurFormat?: boolean;
}

export const PhoneInput = forwardRef<HTMLInputElement, PhoneInputProps>(
  ({ label = "Phone Number", error, value, onChange, onBlurFormat = true, className, ...props }, ref) => {
    const handleBlur = (e: React.FocusEvent<HTMLInputElement>) => {
      if (onBlurFormat) {
        const formatted = formatPhone(e.target.value);
        onChange(formatted);
      }
      props.onBlur?.(e);
    };

    return (
      <div className={cn("space-y-2", className)}>
        <Label htmlFor={props.id}>{label}</Label>
        <Input
          ref={ref}
          type="tel"
          inputMode="numeric"
          value={value}
          onChange={(e) => onChange(e.target.value)}
          onBlur={handleBlur}
          placeholder="9876543210"
          maxLength={10}
          aria-invalid={!!error}
          {...props}
        />
        {error && (
          <p className="text-xs text-destructive">{error}</p>
        )}
      </div>
    );
  }
);
PhoneInput.displayName = "PhoneInput";
```

**Create DateInput component:**

File: `client/src/components/forms/fields/DateInput.tsx`

```typescript
import { forwardRef, type InputHTMLAttributes } from "react";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { formatDOB } from "@/lib/form-formatters";
import { cn } from "@/lib/utils";

export interface DateInputProps
  extends Omit<InputHTMLAttributes<HTMLInputElement>, "type" | "onChange"> {
  label?: string;
  error?: string;
  value: string;
  onChange: (value: string) => void;
  onBlurFormat?: boolean;
}

export const DateInput = forwardRef<HTMLInputElement, DateInputProps>(
  ({ label = "Date of Birth", error, value, onChange, onBlurFormat = true, className, ...props }, ref) => {
    const handleBlur = (e: React.FocusEvent<HTMLInputElement>) => {
      if (onBlurFormat) {
        const formatted = formatDOB(e.target.value);
        onChange(formatted);
      }
      props.onBlur?.(e);
    };

    return (
      <div className={cn("space-y-2", className)}>
        <Label htmlFor={props.id}>{label}</Label>
        <Input
          ref={ref}
          type="date"
          value={value}
          onChange={(e) => onChange(e.target.value)}
          onBlur={handleBlur}
          aria-invalid={!!error}
          {...props}
        />
        {error && (
          <p className="text-xs text-destructive">{error}</p>
        )}
      </div>
    );
  }
);
DateInput.displayName = "DateInput";
```
  </action>
  <verify>
1. All three files exist in client/src/components/forms/fields/
2. TypeScript compiles: `cd client && npx tsc --noEmit`
3. Each component imports from @/lib/form-formatters
  </verify>
  <done>
- PANInput calls formatPAN on blur and applies result
- PhoneInput calls formatPhone on blur and applies result
- DateInput uses type="date" and calls formatDOB on blur
- All three show error message when error prop is provided
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PEDSelector component and barrel export</name>
  <files>
    client/src/components/forms/fields/PEDSelector.tsx
    client/src/components/forms/fields/index.ts
  </files>
  <action>
**Create PEDSelector component:**

File: `client/src/components/forms/fields/PEDSelector.tsx`

Per CONTEXT.md: "PED (Pre-Existing Disease) selection: checkbox list of categories + 'Other' text field"
Per CONTEXT.md (Claude's discretion): "'Other' text field expand/collapse behavior for PED" - using Collapsible for smooth animation

```typescript
import { Checkbox } from "@/components/ui/checkbox";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import {
  Collapsible,
  CollapsibleContent,
} from "@/components/ui/collapsible";
import { cn } from "@/lib/utils";

export const PED_CONDITIONS = [
  { id: "diabetes", label: "Diabetes" },
  { id: "bloodPressure", label: "Blood Pressure / Hypertension" },
  { id: "heartAilments", label: "Heart Ailments" },
  { id: "asthma", label: "Asthma / Respiratory" },
  { id: "thyroid", label: "Thyroid Disorders" },
  { id: "cancer", label: "Cancer" },
  { id: "other", label: "Other" },
] as const;

export type PEDConditionId = (typeof PED_CONDITIONS)[number]["id"];

export interface PEDConditions {
  diabetes: boolean;
  bloodPressure: boolean;
  heartAilments: boolean;
  asthma: boolean;
  thyroid: boolean;
  cancer: boolean;
  other: boolean;
}

export interface PEDSelectorProps {
  conditions: PEDConditions;
  onConditionChange: (id: PEDConditionId, checked: boolean) => void;
  otherDescription: string;
  onOtherDescriptionChange: (value: string) => void;
  error?: string;
  otherError?: string;
  className?: string;
}

export function PEDSelector({
  conditions,
  onConditionChange,
  otherDescription,
  onOtherDescriptionChange,
  error,
  otherError,
  className,
}: PEDSelectorProps) {
  return (
    <div className={cn("space-y-4", className)}>
      <Label className="text-base font-medium">
        Pre-Existing Diseases (PED)
      </Label>
      <p className="text-sm text-muted-foreground">
        Select any conditions that apply to you
      </p>

      <div className="space-y-3 p-4 rounded-lg border bg-muted/30">
        {PED_CONDITIONS.map(({ id, label }) => (
          <div key={id} className="flex items-center gap-3">
            <Checkbox
              id={`ped-${id}`}
              checked={conditions[id]}
              onCheckedChange={(checked) =>
                onConditionChange(id, checked === true)
              }
            />
            <Label
              htmlFor={`ped-${id}`}
              className="font-normal cursor-pointer"
            >
              {label}
            </Label>
          </div>
        ))}

        {/* Other description field - expands when "Other" is checked */}
        <Collapsible open={conditions.other}>
          <CollapsibleContent className="pt-2">
            <div className="ml-7 space-y-2">
              <Input
                placeholder="Please describe your condition"
                value={otherDescription}
                onChange={(e) => onOtherDescriptionChange(e.target.value)}
                aria-invalid={!!otherError}
              />
              {otherError && (
                <p className="text-xs text-destructive">{otherError}</p>
              )}
            </div>
          </CollapsibleContent>
        </Collapsible>
      </div>

      {error && (
        <p className="text-xs text-destructive">{error}</p>
      )}
    </div>
  );
}
```

**Create barrel export file:**

File: `client/src/components/forms/fields/index.ts`

```typescript
export { PANInput, type PANInputProps } from "./PANInput";
export { PhoneInput, type PhoneInputProps } from "./PhoneInput";
export { DateInput, type DateInputProps } from "./DateInput";
export {
  PEDSelector,
  type PEDSelectorProps,
  type PEDConditions,
  type PEDConditionId,
  PED_CONDITIONS,
} from "./PEDSelector";
```
  </action>
  <verify>
1. PEDSelector file exists
2. Index barrel export exists
3. TypeScript compiles: `cd client && npx tsc --noEmit`
4. Collapsible import resolves to @/components/ui/collapsible
  </verify>
  <done>
- PEDSelector renders 7 checkbox conditions (diabetes, bloodPressure, heartAilments, asthma, thyroid, cancer, other)
- "Other" text field appears/disappears smoothly when "Other" checkbox is toggled
- Barrel export re-exports all field components and their types
- PED_CONDITIONS constant exported for use in form schemas
  </done>
</task>

</tasks>

<verification>
1. `cd client && npx tsc --noEmit` passes
2. All five files exist in client/src/components/forms/fields/
3. Imports work: `import { PANInput, PhoneInput, DateInput, PEDSelector } from "@/components/forms/fields"`
4. PEDSelector uses Collapsible from shadcn/ui
5. All formatters are called on blur, not onChange
</verification>

<success_criteria>
- PANInput formats to uppercase alphanumeric on blur (e.g., "abc123" -> "ABC123")
- PhoneInput formats to digits-only on blur (e.g., "98-765" -> "98765")
- DateInput uses native date picker with type="date"
- PEDSelector shows all 7 condition checkboxes
- PEDSelector's "Other" text field animates in/out with Collapsible
- All fields show error messages when error prop is provided
- Barrel export provides clean import path
</success_criteria>

<output>
After completion, create `.planning/phases/02-form-infrastructure/02-03-SUMMARY.md`
</output>
